<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Duo Desire (a small IoT project) · Luke Bearl
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Luke Bearl">
<meta name="description" content="My wife was watching Shark Tank a few weeks ago and we were both chatting about a thing we saw (which wasn&rsquo;t funded). It was kind of a clever idea, and I&rsquo;ll sidestep the entire discussion of whether or not it is a &ldquo;good&rdquo; product or not, I just wanted to see what it would take to build something kind of like it (this is loosely inspired by LoveSync, but the LoveSync does have some interesting features around time and also their hardware is much prettier than what I&rsquo;m using).">
<meta name="keywords" content="blog,developer,personal,.net,c#,devops">
<meta name="fediverse:creator" content="" />


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Duo Desire (a small IoT project)">
  <meta name="twitter:description" content="My wife was watching Shark Tank a few weeks ago and we were both chatting about a thing we saw (which wasn’t funded). It was kind of a clever idea, and I’ll sidestep the entire discussion of whether or not it is a “good” product or not, I just wanted to see what it would take to build something kind of like it (this is loosely inspired by LoveSync, but the LoveSync does have some interesting features around time and also their hardware is much prettier than what I’m using).">

<meta property="og:url" content="http://localhost:1313/posts/duo-desire-a-small-iot-project/">
  <meta property="og:site_name" content="Luke Bearl">
  <meta property="og:title" content="Duo Desire (a small IoT project)">
  <meta property="og:description" content="My wife was watching Shark Tank a few weeks ago and we were both chatting about a thing we saw (which wasn’t funded). It was kind of a clever idea, and I’ll sidestep the entire discussion of whether or not it is a “good” product or not, I just wanted to see what it would take to build something kind of like it (this is loosely inspired by LoveSync, but the LoveSync does have some interesting features around time and also their hardware is much prettier than what I’m using).">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-02-14T00:00:00+00:00">
    <meta property="article:modified_time" content="2020-02-14T00:00:00+00:00">
    <meta property="article:tag" content="Azure">
    <meta property="article:tag" content="Iot">
    <meta property="article:tag" content="Rebutton">




<link rel="canonical" href="http://localhost:1313/posts/duo-desire-a-small-iot-project/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Luke Bearl
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/now/">Now</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://registry.jsonresume.org/lbearl?theme=professional">Resume</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/duo-desire-a-small-iot-project/">
              Duo Desire (a small IoT project)
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2020-02-14T00:00:00Z">
                February 14, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/iot/">Iot</a>
      <span class="separator">•</span>
    <a href="/categories/public-cloud/">Public-Cloud</a>
      <span class="separator">•</span>
    <a href="/categories/software-development/">Software-Development</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/azure/">Azure</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/iot/">Iot</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/rebutton/">Rebutton</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>My wife was watching Shark Tank a few weeks ago and we were both chatting about a thing we saw (<a href="https://www.businessinsider.com/lovesync-shark-tank-sex-button-kickstarter-mark-cuban-barabara-corcoran-2020-1"  class="external-link" target="_blank" rel="noopener">which wasn&rsquo;t funded</a>). It was kind of a clever idea, and I&rsquo;ll sidestep the entire discussion of whether or not it is a &ldquo;good&rdquo; product or not, I just wanted to see what it would take to build something kind of like it (this is loosely inspired by LoveSync, but the LoveSync does have some interesting features around time and also their hardware is <em>much</em> prettier than what I&rsquo;m using).</p>
<!-- raw HTML omitted -->
<p><img src="/images/image-4.png" alt=""></p>
<!-- raw HTML omitted -->
<p>The Rebutton (ignore the dirty valet box)</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>As a quick aside: this method of asynchronous communication in which parties are only notified after reaching consensus seems like an interesting UX pattern. I was very interested to see almost the same pattern pop up (in almost the exact opposite context of LoveSync) in the form of the <a href="https://bail-app.netlify.com"  class="external-link" target="_blank" rel="noopener">Bail App</a>, which I believe is still in development (<a href="https://news.ycombinator.com/item?id=22250962"  class="external-link" target="_blank" rel="noopener">if it&rsquo;s even feasible</a>).</p>
<h2 id="quick-overview">
  Quick Overview
  <a class="heading-link" href="#quick-overview">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>So, to the meat of the project: this project is 2 IoT buttons hooked up to an Azure IoT Hub which trigger Azure functions and make use of Azure Table Storage for data persistence. When consensus is reached, a notification is sent via Twilio to all interested parties.</p>
<p>Why Azure you ask? Easy: the buttons that were in stock only had the Azure model available, so that made the decision pretty easy. Amazon&rsquo;s infamous IoT button is apparently no longer for sale to individuals (or if it is it is so well hidden I gave up on looking). Developing this on Azure worked pretty well, although there were some weird issues when I attempted to interact with the IoT Hub service using C#, so I ended up doing everything in Javascript (I know, IoT in JS, I never thought I&rsquo;d see the day).</p>
<h2 id="bill-of-materials">
  Bill of Materials
  <a class="heading-link" href="#bill-of-materials">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>2 <a href="https://www.seeedstudio.com/ReButton-p-2930.html"  class="external-link" target="_blank" rel="noopener">Rebuttons by SeeedStudio</a></li>
<li>1 <a href="https://azure.microsoft.com/en-us/"  class="external-link" target="_blank" rel="noopener">Azure</a> subscription</li>
<li>1 <a href="http://www.twilio.com/referral/L7yzRF"  class="external-link" target="_blank" rel="noopener">Twilio</a> subscription</li>
<li>WiFi access (obviously)</li>
</ul>
<h2 id="building-it">
  Building It
  <a class="heading-link" href="#building-it">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>To start, configure the Rebutton to communicate with your IoT Hub. <a href="https://seeedjp.github.io/ReButton/"  class="external-link" target="_blank" rel="noopener">The docs</a> do a pretty good job of describing this.</p>
<p>Ensure that the buttons are communicating with the hub. This command will let you see events as they come from the event hub: <code>az iot hub monitor-events -n &lt;yourapp&gt; --properties anno sys --timeout 0</code></p>
<p>In the Azure Function Apps blade, you&rsquo;ll need to create the following functions</p>
<h3 id="event-hub-function">
  Event Hub Function
  <a class="heading-link" href="#event-hub-function">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>The first of the three functions needed is the function which will process event hub messages. At a high level all this is doing is being invoked any time an event occurs and then just writing the event data to the Azure Table Storage table defined in the configuration. You&rsquo;ll need to configure it something like:</p>
<!-- raw HTML omitted -->
<p><img src="/images/image-1.png" alt=""></p>
<!-- raw HTML omitted -->
<p>The Azure IoT Event Hub function</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>The code for the function is <a href="https://gist.github.com/lbearl/34dee5c7d971d44c8591cc8c43b73cb9#file-duodesire_iothub-js"  class="external-link" target="_blank" rel="noopener">here.</a> As I alluded to above, I was having some weird issues with the C# bindings in Visual Studio, so I ended up just writing everything in Javascript directly in browser. Not the greatest development environment&hellip;</p>
<h3 id="timer-function">
  Timer Function
  <a class="heading-link" href="#timer-function">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>The timer is the next function. It runs on whatever cron schedule is defined (I currently have it running every 10 minutes), and it just looks for consensus in the table for both configured devices. Consensus in this case is defined as one or more single-click events from each device. If any non-single-click events are discovered, then it is assumed that consensus is impossible, and the messages will not go out. It would be an interesting exercise to extend the current logic and use the other button events (double-click, long-press, super-long-press) for other functions.</p>
<p>Upon discovering consensus, the timer function writes to an Azure Queue and writes a &ldquo;FINISH&rdquo; record to the table storage to prevent the next run of the function from also triggering a message.</p>
<!-- raw HTML omitted -->
<p><img src="/images/image-2.png" alt=""></p>
<!-- raw HTML omitted -->
<p>The timer configuration</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>The code for it is <a href="https://gist.github.com/lbearl/34dee5c7d971d44c8591cc8c43b73cb9#file-timer-js"  class="external-link" target="_blank" rel="noopener">here</a>.</p>
<h3 id="queue-trigger-function">
  Queue Trigger Function
  <a class="heading-link" href="#queue-trigger-function">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>The final function needed is the queue trigger which is responsible for actually sending the messages to Twilio. <a href="https://gist.github.com/lbearl/34dee5c7d971d44c8591cc8c43b73cb9#file-queuetrigger-js"  class="external-link" target="_blank" rel="noopener">The code</a> is incredibly simple as Azure has a pre-built integration with Twilio which abstracts away the vast majority of the code that would otherwise need to be written.</p>
<!-- raw HTML omitted -->
<p><img src="/images/image-3.png" alt=""></p>
<!-- raw HTML omitted -->
<p>The Queue Trigger configuration</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>At this point, everything should be wired up, so pressing both buttons should trigger the Twilio message.</p>
<h2 id="worth-it">
  Worth It?
  <a class="heading-link" href="#worth-it">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Assuming usage remains fairly constant, Azure forecasts that I&rsquo;ll spend ~$0.30 per month, plus ~$50 for the buttons. I think it&rsquo;s worth it for the fun I had building this, plus if the current application of the buttons gets stale, I&rsquo;m sure I can repurpose them for something else. Interestingly, these buttons are built on the Arduino platform, so conceivably I could do a whole lot of customization by changing the <a href="https://github.com/SeeedJP/ReButtonApp"  class="external-link" target="_blank" rel="noopener">firmware</a> around (which might happen eventually).</p>
<p><img src="/images/pricing-azure-summary.png.webp" alt=""></p>
<h2 id="in-closing">
  In Closing
  <a class="heading-link" href="#in-closing">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>This was a fun project which didn&rsquo;t take very long to put together and entertained me. It was a timely project for Valentine&rsquo;s Day. If you end up building something like it or have any feedback on this article, please <a href="https://lukebearl.com/contact-me/"  class="external-link" target="_blank" rel="noopener">reach out</a>, I&rsquo;d love to hear!</p>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
    <section class="container">
      ©
      
        2016 -
      
      2024
       Luke Bearl 
      · Made with <i class="fa-solid fa-heart"></i> in Minnesota
      
      
    </section>
  </footer>
  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
