<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Making EF work with DotNet SPA 2.0.0 prerelease · Luke Bearl
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Luke Bearl">
<meta name="description" content="The Microsoft.DotNet.Web.Spa.ProjectTemplates::2.0.0-rc2-final SPA template currently has a little issue with making EF work properly. If you encounter this issue you&rsquo;ll notice that running Update-Database in the Package Manager Console results in ng serve being run, which prevents the migrations from being applied.
To fix the issue, we need to slightly change Program.cs and Startup.cs as follows:
    public class Program
    {
        public static void Main(string[] args)
        {
            // This needs to have all of the code originally in BuildWebHost
            WebHost.CreateDefaultBuilder(args)
                .UseStartup&lt;Startup&gt;().Build().Run();
        }

        // This is only invoked by EF
        public static IWebHost BuildWebHost(string[] args) =&gt;
            WebHost.CreateDefaultBuilder(args)
            .ConfigureAppConfiguration((ctx, cfg) =&gt;
            {
                cfg.SetBasePath(Directory.GetCurrentDirectory())
                  .AddJsonFile(&#34;appSettings.json&#34;, true) // require the appsettings file!
                  .AddEnvironmentVariables();
            })
                .UseStartup&lt;Startup&gt;().UseSetting(&#34;DesignTime&#34;, &#34;true&#34;).Build();
    }
">
<meta name="keywords" content="blog,developer,personal,.net,c#,devops">
<meta name="fediverse:creator" content="" />


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Making EF work with DotNet SPA 2.0.0 prerelease">
  <meta name="twitter:description" content="The Microsoft.DotNet.Web.Spa.ProjectTemplates::2.0.0-rc2-final SPA template currently has a little issue with making EF work properly. If you encounter this issue you’ll notice that running Update-Database in the Package Manager Console results in ng serve being run, which prevents the migrations from being applied.
To fix the issue, we need to slightly change Program.cs and Startup.cs as follows:
public class Program { public static void Main(string[] args) { // This needs to have all of the code originally in BuildWebHost WebHost.CreateDefaultBuilder(args) .UseStartup&lt;Startup&gt;().Build().Run(); } // This is only invoked by EF public static IWebHost BuildWebHost(string[] args) =&gt; WebHost.CreateDefaultBuilder(args) .ConfigureAppConfiguration((ctx, cfg) =&gt; { cfg.SetBasePath(Directory.GetCurrentDirectory()) .AddJsonFile(&#34;appSettings.json&#34;, true) // require the appsettings file! .AddEnvironmentVariables(); }) .UseStartup&lt;Startup&gt;().UseSetting(&#34;DesignTime&#34;, &#34;true&#34;).Build(); } ">

<meta property="og:url" content="http://localhost:1313/posts/making-ef-work-with-dotnet-spa-2-0-0-prerelease/">
  <meta property="og:site_name" content="Luke Bearl">
  <meta property="og:title" content="Making EF work with DotNet SPA 2.0.0 prerelease">
  <meta property="og:description" content="The Microsoft.DotNet.Web.Spa.ProjectTemplates::2.0.0-rc2-final SPA template currently has a little issue with making EF work properly. If you encounter this issue you’ll notice that running Update-Database in the Package Manager Console results in ng serve being run, which prevents the migrations from being applied.
To fix the issue, we need to slightly change Program.cs and Startup.cs as follows:
public class Program { public static void Main(string[] args) { // This needs to have all of the code originally in BuildWebHost WebHost.CreateDefaultBuilder(args) .UseStartup&lt;Startup&gt;().Build().Run(); } // This is only invoked by EF public static IWebHost BuildWebHost(string[] args) =&gt; WebHost.CreateDefaultBuilder(args) .ConfigureAppConfiguration((ctx, cfg) =&gt; { cfg.SetBasePath(Directory.GetCurrentDirectory()) .AddJsonFile(&#34;appSettings.json&#34;, true) // require the appsettings file! .AddEnvironmentVariables(); }) .UseStartup&lt;Startup&gt;().UseSetting(&#34;DesignTime&#34;, &#34;true&#34;).Build(); } ">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-02-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2018-02-21T00:00:00+00:00">




<link rel="canonical" href="http://localhost:1313/posts/making-ef-work-with-dotnet-spa-2-0-0-prerelease/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Luke Bearl
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/now/">Now</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://registry.jsonresume.org/lbearl?theme=professional">Resume</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/making-ef-work-with-dotnet-spa-2-0-0-prerelease/">
              Making EF work with DotNet SPA 2.0.0 prerelease
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2018-02-21T00:00:00Z">
                February 21, 2018
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              One-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/software-development/">Software-Development</a></div>

          
        </div>
      </header>

      <div class="post-content">
        
        <p>The Microsoft.DotNet.Web.Spa.ProjectTemplates::2.0.0-rc2-final SPA template currently has a little issue with making EF work properly. If you encounter this issue you&rsquo;ll notice that running <code>Update-Database</code> in the Package Manager Console results in <code>ng serve</code> being run, which prevents the migrations from being applied.</p>
<p>To fix the issue, we need to slightly change <code>Program.cs</code> and <code>Startup.cs</code> as follows:</p>
<pre tabindex="0"><code>    public class Program
    {
        public static void Main(string[] args)
        {
            // This needs to have all of the code originally in BuildWebHost
            WebHost.CreateDefaultBuilder(args)
                .UseStartup&lt;Startup&gt;().Build().Run();
        }

        // This is only invoked by EF
        public static IWebHost BuildWebHost(string[] args) =&gt;
            WebHost.CreateDefaultBuilder(args)
            .ConfigureAppConfiguration((ctx, cfg) =&gt;
            {
                cfg.SetBasePath(Directory.GetCurrentDirectory())
                  .AddJsonFile(&#34;appSettings.json&#34;, true) // require the appsettings file!
                  .AddEnvironmentVariables();
            })
                .UseStartup&lt;Startup&gt;().UseSetting(&#34;DesignTime&#34;, &#34;true&#34;).Build();
    }
</code></pre><p>In <code>Startup.cs</code> look for <code>app.UseSpa</code> inside of <code>Configure</code>:</p>
<pre tabindex="0"><code>            app.UseSpa(spa =&gt;
            {
                // To learn more about options for serving an Angular SPA from ASP.NET Core,
                // see https://go.microsoft.com/fwlink/?linkid=864501

                spa.Options.SourcePath = &#34;ClientApp&#34;;
                // Get the &#34;DesignTime&#34; configuration param set above
                bool.TryParse(Configuration[&#34;DesignTime&#34;], out var designTime);
                // Only launch the server if we are in development mode AND we are not in design time (which is EF)
                if (env.IsDevelopment() &amp;&amp; !designTime)
                {
                    spa.UseAngularCliServer(npmScript: &#34;start&#34;);
                }
            });
</code></pre><p>With those changes Entity Framework starts working perfectly again. Hope this saves people a few hours.</p>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
    <section class="container">
      ©
      
        2016 -
      
      2024
       Luke Bearl 
      · Made with <i class="fa-solid fa-heart"></i> in Minnesota
      
      
    </section>
  </footer>
  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
